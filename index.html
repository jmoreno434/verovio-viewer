<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>MusicXML → SVG con Verovio</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <!-- Toolkit JS (misma carpeta que su .wasm en el CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/verovio@5.4.0/dist/verovio-toolkit-wasm.js" defer></script>
  <script>
    // (opcional) ver qué URL usará para el .wasm
    window.verovio = window.verovio || {};
    verovio.module = verovio.module || {};
    verovio.module.locateFile = (path, prefix) => (prefix || '') + path;
  </script>
  <style>
    body { font-family: system-ui, sans-serif; margin: 0; padding: 16px; }
    #out { border: 1px solid #ddd; background:#fff; min-height: 200px; }
  </style>
</head>
<body>
  <h1>MusicXML → SVG</h1>
  <div id="out">SVG aquí…</div>

  <script>
    // 1) Esperar a que WASM esté listo y crear el toolkit
    const tkReady = new Promise((resolve) => {
      verovio.module.onRuntimeInitialized = () => {
        const tk = new verovio.toolkit({
          // Opciones básicas de layout; ajusta a tu gusto
          pageWidth: 2100,      // "A4" en décimas de mm aprox.
          pageHeight: 2970,
          scale: 40             // zoom (100 = tamaño base)
        });
        resolve(tk);
      };
    });

    // 2) Función utilitaria: MusicXML (string) → SVG (string)
    async function musicxmlToSvg(xmlString, { page = 1, options = {} } = {}) {
      const tk = await tkReady;
      if (options && Object.keys(options).length) tk.setOptions(options);
      // Verovio auto-detecta el formato; MusicXML es válido aquí
      // También puedes forzar opciones de entrada si quieres.
      tk.loadData(xmlString);
      return tk.renderToSVG(page, {}); // página 1 por defecto
    }

    // --- DEMO: probar con un MusicXML corto embebido ---
    const DEMO_XML = `<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE score-partwise PUBLIC "-//Recordare//DTD MusicXML 3.1 Partwise//EN" "http://www.musicxml.org/dtds/partwise.dtd">
<score-partwise version="3.1">
  <part-list><score-part id="P1"><part-name>Demo</part-name></score-part></part-list>
  <part id="P1">
    <measure number="1">
      <attributes><divisions>1</divisions><key><fifths>0</fifths></key>
        <time><beats>4</beats><beat-type>4</beat-type></time>
        <clef><sign>G</sign><line>2</line></clef>
      </attributes>
      <note><pitch><step>C</step><octave>4</octave></pitch><duration>1</duration><type>quarter</type></note>
      <note><pitch><step>D</step><octave>4</octave></pitch><duration>1</duration><type>quarter</type></note>
      <note><pitch><step>E</step><octave>4</octave></pitch><duration>1</duration><type>quarter</type></note>
      <note><rest/><duration>1</duration><type>quarter</type></note>
      <barline location="right"><bar-style>light-heavy</bar-style></barline>
    </measure>
  </part>
</score-partwise>`;

    (async () => {
      const svg = await musicxmlToSvg(DEMO_XML);
      document.getElementById('out').innerHTML = svg;
    })();
  </script>
</body>
</html>







